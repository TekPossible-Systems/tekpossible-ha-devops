name: RHEL9Setup
description: Complete Custom Setup of RHEL 9
schemaVersion: 1.0

phases:
  - name: build
    steps:
      - name: RHEL9Setup
        action: ExecuteBash
        inputs:
          commands:
            - dnf update -y
            - dnf install -y ansible-core unzip git python3-pip
            - pip3 install git-remote-codecommit
            - mkdir /staging
            - cd /staging/git-repo
            - git clone $(aws ssm get-parameter --name $CDK_STACK_BASE_NAME_LOWER-image-repo --query 'Parameter.Value' | sed 's/"//g')
            - cd ./*ami*
            - bash ./setup_image.sh